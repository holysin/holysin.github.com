<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>holysin&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="holysin's blog">
<meta property="og:url" content="http://devliu.com/index.html">
<meta property="og:site_name" content="holysin's blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="holysin's blog">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="holysin&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">holysin&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://devliu.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Objective-C-内存管理学习笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/10/19/Objective-C-内存管理学习笔记/" class="article-date">
  <time datetime="2015-10-19T06:22:46.000Z" itemprop="datePublished">2015-10-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/19/Objective-C-内存管理学习笔记/">Objective-C 内存管理学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>sunnyxx发了一份iOS面试题，这份面试题前面的几个题都是关于内存管理的，github上也有同学给出<br>了很好的答案，但是有很多答案都是重复的，遂整理如下。</p>
<h1 id="property">property</h1><h2 id="定义">定义</h2><p>property的本质是实例变量的 getter 和 setter 方法。即 \@property = ivar + getter + setter。<br>属性定义之后，编译器会自动生成实例变量的 getter 和 setter 方法。</p>
<h2 id="property_关键字">property 关键字</h2><h3 id="property_的关键字主要分为四类：">property 的关键字主要分为四类：</h3><ol>
<li><p>原子性 nonatomic, atomic</p>
<p> 在默认情况下，由编译器合成的方法会通过锁定机制确保其原子性(atomicity)。如果属性具备<br> nonatomic 特质，则不使用同步锁。请注意，尽管没有名为“atomic”的特质(如果某属性不具备<br> nonatomic 特质，那它就是“原子的” ( atomic) )，但是仍然可以在属性特质中写明这一点，<br> 编译器不会报错。若是自己定义存取方法，那么就应该遵从与属性特质相符的原子性。</p>
</li>
<li><p>读写权限 readOnly, readwrite</p>
</li>
<li><p>内存管理 assign, strong, weak, unsafe_unretained, copy</p>
</li>
<li><p>方法名 getter, setter</p>
</li>
<li><p>不常用的 nonnull, null_resettable, nullable</p>
</li>
</ol>
<p>property 各个关键字的作用会在下面详细讨论。</p>
<h3 id="property_默认关键字">property 默认关键字</h3><p>在声明property时，如果不指定关键字，编译器会为property生成默认的关键字。</p>
<ol>
<li><p>对应基本数据类型，默认关键字为<br>atomic, assign, readwrite</p>
</li>
<li><p>对应对象类型，默认关键字为<br>atomic, strong, readwrite</p>
</li>
</ol>
<p>参考链接：</p>
<ol>
<li><p><a href="http://stackoverflow.com/questions/8927727/objective-c-arc-strong-vs-retain-and-weak-vs-assign/15541801#15541801" target="_blank" rel="external">Objective-C ARC: strong vs retain and weak vs assign</a></p>
</li>
<li><p><a href="http://rdcworld-iphone.blogspot.in/2012/12/variable-property-attributes-or.html" target="_blank" rel="external">Variable property attributes or Modifiers in iOS</a></p>
</li>
</ol>
<h3 id="property_合成规则">property 合成规则</h3><p>我们用这样一个类来说明</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@interface</span> <span class="attribute">Person </span>: NSObject</span><br><span class="line"></span><br><span class="line"><span class="variable">@property</span> (nonatomic, copy) NSString *name;</span><br><span class="line"></span><br><span class="line"><span class="variable">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="默认规则">默认规则</h4><p>setter<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">-</span> (<span class="tag">void</span>)<span class="rule"><span class="attribute">setName</span>:<span class="value">(NSString *)name</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>getter<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (NSString *)<span class="property">name</span>;</span><br></pre></td></tr></table></figure></p>
<p>自动生成的 ivar 是 _name。</p>
<h4 id="特殊情况一">特殊情况一</h4><p>在 .m 中添加如下代码：<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@implementation</span> Person</span><br><span class="line"></span><br><span class="line"><span class="variable">@synthesize</span> name;</span><br><span class="line"></span><br><span class="line"><span class="variable">@end</span></span><br></pre></td></tr></table></figure></p>
<p>setter 和 getter 不变，ivar 变为 name;</p>
<h4 id="特殊情况二">特殊情况二</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *_name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>系统会自动把 name 和 _name 关联</p>
<h4 id="特殊情况三">特殊情况三</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>不要被这种情况蒙蔽，系统不会自动把 name property 和 name ivar 关联，需要手动关联<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@synthesize <span class="property">name</span> = <span class="property">name</span>;</span><br></pre></td></tr></table></figure></p>
<p>或者<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="at_rule">@<span class="keyword">synthesize</span> name</span>;</span><br></pre></td></tr></table></figure></p>
<p>根据以上情况我们可以总结出：编译器只会把 name 和 _name （自定义也可以） 进行自动关联，其<br>他情况都需要手动合成。</p>
<h2 id="在_protocol_中使用_property">在 protocol 中使用 property</h2><p>笔者曾经在一次面试中被问到了这个知识点，当时就懵了，因为自己从来就没有这么用过。面试结束，仔细<br>想想，其实面试官就是想考察 property 的本质。property 的 本质就是实例变量的 accessor 方法。<br>所以在 protocol 中用 property，无非就是让实现该 protocol 的对象实现相应的 accessor 方法。<br>其实 iOS 内部就有在 protocol 中定义 property 的例子，比如 <strong>CAMediaTiming</strong> 。</p>
<p>那么在实现定义了 property 的 protocol 需要注意什么呢？我们还是用代码亲自试验一下。<br>首先定义 PersonProtocol</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@protocol</span> PersonProtocol &lt;NSObject&gt;</span><br><span class="line"></span><br><span class="line"><span class="variable">@property</span> (nonatomic, copy) NSString *name;</span><br><span class="line"></span><br><span class="line"><span class="variable">@end</span></span><br></pre></td></tr></table></figure>
<p>然后定义 Person 遵从 PersonProtocol<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@interface</span> <span class="attribute">Person </span>: NSObject &lt;PersonProtocol&gt;</span><br><span class="line"></span><br><span class="line"><span class="variable">@end</span></span><br></pre></td></tr></table></figure></p>
<p>这时系统会提示警告：<br><img src="/images/objc_memory_management/objc_mm_1.png" alt="警告"><br>我们可以用 synthesize 合成变量来实现对应的 accessor。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@implementation</span> Person</span><br><span class="line"></span><br><span class="line"><span class="variable">@synthesize</span> name = _name;</span><br><span class="line"></span><br><span class="line"><span class="variable">@end</span></span><br></pre></td></tr></table></figure>
<p>当然也可以手动实现 getter 和 setter 方法。这里就不在赘述。</p>
<p>平时我们在 protocol 中大多定义一些动作型的方法。在 protocol 中定义 property 开阔了使用<br>protocol 的思路。不失为一种好的实践。</p>
<h2 id="在_category_中使用_property">在 category 中使用 property</h2><p>category 本身是不能定义属性的。但 property 的本质是 accessor 方法，所以我们可以 associate<br>来实现。<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@interface</span> Person (name)</span><br><span class="line"></span><br><span class="line"><span class="variable">@property</span> (nonatomic, copy) NSString *name;</span><br><span class="line"></span><br><span class="line"><span class="variable">@end</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">"Person+name.h"</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> *nameKey = <span class="literal">nil</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span> (<span class="title">name</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setName:(<span class="built_in">NSString</span> *)name</span><br><span class="line">&#123;</span><br><span class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, &amp;nameKey, name, OBJC_ASSO<span class="built_in">CIATION_COPY_NONATOMIC</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)name</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, &amp;nameKey);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>用 associate 关联的对象不用自己手动释放。NSObject dealloc 的最后一步就是清理 associate<br>对象。详情可参考runtime的源码。</p>
<h2 id="weak">weak</h2><h2 id="定义-1">定义</h2><p>weak 表示 property 不持有对象，且在对象 dealloc 的时候，把 weak 属性的值置为 nil。</p>
<h2 id="weak,_assign,_unsafe_unretained_的区别">weak, assign, unsafe_unretained 的区别</h2><ol>
<li><p>weak 只能用于对象类型</p>
</li>
<li><p>assign 既能用于基本数据类型，也能用于对象数据类型。不持有对象。如果用于对象类型，<br>在对象 dealloc 之后，属性的值不变，有访问野指针的危险。</p>
</li>
<li><p>在 Cocoa 和 Cocoa Touch 有很少一些类还不支持 weak，比如 NSTextView, NSFont 等。<br>对于这些类型如果想用 weak 类型，你需要用 unsafe_unretained 关键字。unsafe_unretained<br>和 weak 类型一样不会持有对象，<br>但是在对象 dealloc 之后，不会自动置为空。有访问野指针的危险。</p>
</li>
</ol>
<h2 id="用_runtime_如何实现_weak_属性">用 runtime 如何实现 weak 属性</h2><h2 id="clang_实现">clang 实现</h2><p><a href="http://clang.llvm.org/docs/AutomaticReferenceCounting.html#arc-runtime-objc-storeweak" target="_blank" rel="external">llvm 官网</a>列出了 runtime 中用来实现 weak 的函数，如下</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="property">id</span> objc_storeWeak(<span class="property">id</span>* object, <span class="property">id</span> value)</span><br></pre></td></tr></table></figure>
<ul>
<li>value 是一个指针指向为 weak 属性赋值的对象，或者为null</li>
<li>object 是 weak 属性的地址</li>
</ul>
<p>如果 value 是 null 或者 value 指向的对象开始 dealloc, object 会被赋值为 null 并且注销<br><strong>__</strong>weak 身份。否则 object 会注册为 <strong>__</strong>weak 对象，并把自己的值改成 value。</p>
<p>根据 weak 的定义，用 objc_storeWeak 实现 weak 的伪代码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在赋值之前把 obj1 的值改为 obj 的值，在 obj dealloc 之后，把obj1的值改为 0</span></span><br><span class="line">id obj1;</span><br><span class="line">obj1 = <span class="number">0</span>;</span><br><span class="line">objc_storeWeak(&amp;obj1, obj);</span><br><span class="line"><span class="comment">/* ... obj的引用计数变为0，被置nil ... */</span></span><br><span class="line">objc_storeWeak(&amp;obj1, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<h2 id="自己模拟">自己模拟</h2><p>自己实现 weak 最关键的地方在于：对象 dealloc 时把 property 的值置为 nil。显然，继承<br>NSObject, 重写 dealloc 方法的解决方案不够优雅。我们考虑用 category 来实现。思路是：</p>
<ol>
<li><p>用 associate 给 NSObject 关联一个对象 DeallocExecutor，该对象用 block 的方式记录<br>我们希望在 dealloc 中的行为。</p>
</li>
<li><p>associate 对象会在宿主对象 dealloc 时，自动 dealloc。</p>
</li>
<li><p>重写 property 的 setter 方法</p>
</li>
</ol>
<p>DeallocExecutor 的定义：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">typedef</span> <span class="tag">void</span>(^<span class="tag">voidBlock</span>)(<span class="tag">void</span>);</span><br><span class="line"></span><br><span class="line"><span class="at_rule">@<span class="keyword">interface</span> DeallocExecutor : NSObject </span>&#123;</span><br><span class="line">    <span class="tag">voidBlock</span> _<span class="tag">block</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">-</span> (<span class="tag">instancetype</span>)<span class="rule"><span class="attribute">initWithBlock</span>:<span class="value">(voidBlock)block</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="at_rule">@<span class="keyword">end</span></span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">"DeallocExecutor.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DeallocExecutor</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithBlock:(voidBlock)block</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        _block = [block <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)dealloc</span><br><span class="line">&#123;</span><br><span class="line">    _block ? _block() : <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>给 NSObject 添加一个 category:</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSObject</span> (<span class="title">runAtDealloc</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)runAtDealloc:(voidBlock)block;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSObject</span> (<span class="title">runAtDealloc</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)runAtDealloc:(voidBlock)block</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (block) &#123;</span><br><span class="line">        DeallocExecutor *executor = [[DeallocExecutor alloc] initWithBlock:block];</span><br><span class="line">        objc_setAssociatedObject(<span class="keyword">self</span>, _cmd, executor, OBJC_ASSO<span class="built_in">CIATION_RETAIN</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>重写 property 的 setter 方法</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (void)setObject:(<span class="type">NSObject</span> *)<span class="class"><span class="keyword">object</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    objc_setAssociatedObject(self, <span class="string">"object"</span>, <span class="class"><span class="keyword">object</span>, <span class="title">OBJC_ASSOCIATION_ASSIGN</span>);</span></span><br><span class="line">    [<span class="class"><span class="keyword">object</span> <span class="title">runAtDealloc</span>:</span>^&#123;</span><br><span class="line">        _object = nil;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="http://stackoverflow.com/questions/22809848/objective-c-runtime-run-code-at-deallocation-of-any-object/31560217#31560217" target="_blank" rel="external">参考链接</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://devliu.com/2015/10/19/Objective-C-内存管理学习笔记/" data-id="cify21buo0021ymujzhauw5cp" class="article-share-link">Share</a>
      
        <a href="http://devliu.com/2015/10/19/Objective-C-内存管理学习笔记/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Objective-C/">Objective-C</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ReactiveCocoa" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/10/05/ReactiveCocoa/" class="article-date">
  <time datetime="2015-10-05T10:20:38.000Z" itemprop="datePublished">2015-10-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/05/ReactiveCocoa/">ReactiveCocoa</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Reactive_Philosophy">Reactive Philosophy</h1><h2 id="Imperative_programming">Imperative programming</h2><p>error-prone, relies too heavily on the infallibility of the programmer</p>
<h2 id="Functional_Reactive_programming">Functional Reactive programming</h2><h3 id="Functions_don’t_have_side-effects">Functions don’t have side-effects</h3><h3 id="there’s_no_mutable_state">there’s no mutable state</h3><p>It’s a difficult way to program since the real world is mutable. Modeling things like user input becomes a nightmare.</p>
<h2 id="Reactive_programming">Reactive programming</h2><p>the best way to describe reactive programming is to think of a spreadsheet. Imagine three cells, A, B, and C. A is defined as the sum of B and C. Whenever B or C changes, A reacts to update itself. That’s reactive programming: changes propagate throughout a system automatically.</p>
<p>combination of functional and reactive paradigms.</p>
<h3 id="Core_—_signal">Core — signal</h3><p>At the core of FRP is a signal. A signal simply sends values over time. It sends values until it either completes, or errors out, at which point it stops sending values forever. A signal either completes or errors out, but not both. Signals become useful when they’re subscribed to or used with bindings.</p>
<h3 id="Signal_transform">Signal transform</h3><h3 id="Map">Map</h3><p>A map is an operator that takes in a signal as a receiver, performs some operation on the values sent over that signal, and generates a new signal with the new, mapped values.</p>
<h3 id="Side-effects">Side-effects</h3><h4 id="Subscribe_a_signal_and_perform_side_effects">Subscribe a signal and perform side effects</h4><p>A good example would be the signal emitted by a button  when it’s pressed; we can subscribe to that signal in order to perform side effects.</p>
<h3 id="Bind_a_signal_to_a_property">Bind a signal to a property</h3><p>For example, a signal that sends the location of a gesture recognizer can be mapped to a color and bound to the background color of a view. Then, when the user changes their tap position, the view changes color.</p>
<p>In a summary, we can set up at the beginning of an application runtime and tell the code what to do without telling it how to do it. This is the value of functional reactive programming.</p>
<h2 id="Core_—_derived_state">Core — derived state</h2><p>The derived state means that you never explicitly set the value of a bound property, but rather rely on signal transformations to derive that state for you.</p>
<h1 id="Framework_Overview">Framework Overview</h1><h2 id="Streams">Streams</h2><p>RACStream is any series of object values. Stream allows complex operations to be built on a few basic primitives(-bind: in particular).</p>
<h2 id="Signals">Signals</h2><p>Signals generally represent data that will be delivered in the future. Users must subscribe to a signal in order to access its values.</p>
<p>Signals send three different types of events to their subscribers:</p>
<ul>
<li><p>The next event provides a new value from the stream. RACStream methods only operate on event of this type. Signal could include nil.</p>
</li>
<li><p>The error event indicates that an error occurred before the signal could finish. The event may include an NSError object that indicates what went wrong. Errors must be handled specially – they are not included in the stream’s values.</p>
</li>
<li><p>The completed event indicates that the signal finished successfully, and that no more values will be added to the stream. Completion must be handled specially – it is not included in the stream of values.</p>
</li>
</ul>
<p>The lifetime of a signal consists of any number of next events, followed by one error or completed event (but not both).</p>
<h2 id="Subscription">Subscription</h2><p>A subscriber is anything that is waiting or capable of waiting for events from a signal. Within RAC, a subscriber is represented as any object that conforms to the RACSubscriber protocol.</p>
<p>A subscription is created through any call to -subscribeNext:error:completed:, or one of the corresponding convenience methods. Technically, most RACStream and RACSignal operators create subscriptions as well, but these intermediate subscriptions are usually an implementation detail.</p>
<h2 id="Subjects">Subjects</h2><p>A subject, represented by the RACSubject class, is a signal that can be manually controlled.</p>
<p>Subjects are useful for bridging non-RAC code into the world of signals.</p>
<p>For example, instead of handling logic in block callbacks, you can send events or values to a subject. You can subscribe the subject and perform your task.</p>
<h2 id="Commands">Commands</h2><p>A command, represented by the RACCommand class, creates and subscribes to a signal in response to some action. This makes it easy to perform side-effects when user interacts with the app.</p>
<p>Usually the action triggering a command is UI-driven, like when a button is clicked. Commands can also be automatically disabled based on a signal, and this disabled state can be represented in a UI by disabling any controls associated with the command.</p>
<p>On OS X, RAC adds a rac_command property to NSButton for setting up these behaviors automatically.</p>
<h2 id="Connections">Connections</h2><p>RAC 参考教程</p>
<h2 id="官方文档_-_针对objc">官方文档 - 针对objc</h2><p><a href="https://github.com/ReactiveCocoa/ReactiveCocoa/tree/master/Documentation/Legacy" target="_blank" rel="external">https://github.com/ReactiveCocoa/ReactiveCocoa/tree/master/Documentation/Legacy</a></p>
<h2 id="raywenderlich">raywenderlich</h2><p><a href="http://www.raywenderlich.com/62699/reactivecocoa-tutorial-pt1" target="_blank" rel="external">http://www.raywenderlich.com/62699/reactivecocoa-tutorial-pt1</a><br><a href="http://www.raywenderlich.com/62796/reactivecocoa-tutorial-pt2" target="_blank" rel="external">http://www.raywenderlich.com/62796/reactivecocoa-tutorial-pt2</a></p>
<h2 id="blog">blog</h2><p><a href="http://limboy.me/ios/2014/06/06/deep-into-reactivecocoa2.html" target="_blank" rel="external">http://limboy.me/ios/2014/06/06/deep-into-reactivecocoa2.html</a><br><a href="http://limboy.me/ios/2013/06/19/frp-reactivecocoa.html" target="_blank" rel="external">http://limboy.me/ios/2013/06/19/frp-reactivecocoa.html</a><br><a href="http://www.teehanlax.com/blog/getting-started-with-reactivecocoa/" target="_blank" rel="external">http://www.teehanlax.com/blog/getting-started-with-reactivecocoa/</a><br><a href="http://rcdp.io/flattenMap-vs-map-switchToLatest.html" target="_blank" rel="external">http://rcdp.io/flattenMap-vs-map-switchToLatest.html</a><br><a href="http://spin.atomicobject.com/" target="_blank" rel="external">http://spin.atomicobject.com/</a><br><a href="http://codeblog.shape.dk/blog/2013/12/05/reactivecocoa-essentials-understanding-and-using-raccommand/" target="_blank" rel="external">http://codeblog.shape.dk/blog/2013/12/05/reactivecocoa-essentials-understanding-and-using-raccommand/</a><br><a href="https://github.com/mailworks/LearnReactivecocoaSource" target="_blank" rel="external">https://github.com/mailworks/LearnReactivecocoaSource</a></p>
<h2 id="app">app</h2><p><a href="https://github.com/AshFurrow/C-41" target="_blank" rel="external">https://github.com/AshFurrow/C-41</a><br><a href="https://github.com/jspahrsummers/GroceryList" target="_blank" rel="external">https://github.com/jspahrsummers/GroceryList</a></p>
<p>RAC &amp;&amp; MVVM<br><a href="http://www.sprynthesis.com/2014/12/06/reactivecocoa-mvvm-introduction/" target="_blank" rel="external">http://www.sprynthesis.com/2014/12/06/reactivecocoa-mvvm-introduction/</a><br><a href="http://cocoasamurai.blogspot.com/2013/03/basic-mvvm-with-reactivecocoa.html" target="_blank" rel="external">http://cocoasamurai.blogspot.com/2013/03/basic-mvvm-with-reactivecocoa.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://devliu.com/2015/10/05/ReactiveCocoa/" data-id="cify21bum0020ymujywcmjzfq" class="article-share-link">Share</a>
      
        <a href="http://devliu.com/2015/10/05/ReactiveCocoa/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-resume" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/08/31/resume/" class="article-date">
  <time datetime="2015-08-31T05:50:17.000Z" itemprop="datePublished">2015-08-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/08/31/resume/">resume</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="学历">学历</h1><h2 id="硕士_东北大学_2010-09_-_2012-07_计算机应用技术">硕士 东北大学 2010.09 - 2012.07 计算机应用技术</h2><h2 id="学士_长安大学_2005-09_-_2009-07_建筑设施智能技术">学士 长安大学 2005.09 - 2009.07 建筑设施智能技术</h2><h1 id="工作经历">工作经历</h1><h2 id="猎豹移动_2013-04_至今">猎豹移动 2013.04 至今</h2><h3 id="iOS_电池医生">iOS 电池医生</h3><ul>
<li>充电屏保开发，负责充电屏保复杂动画的开发工作</li>
<li>应用市场，定制TableView，实现上滑隐藏顶部导航栏，定制tableView实现表格布局，优化滚动速度。封装应用市场SDK，提供给第三方厂商使用</li>
<li>应用市场自定义顶部导航栏</li>
<li>活动中心</li>
</ul>
<h3 id="iOS_shine">iOS shine</h3><ul>
<li>自定义UICollectionView布局，实现瀑布流效果</li>
<li>定制TabbarController，实现推入页面隐藏底部tabbar.</li>
<li>扩展SDWebImage，实现对animated webp格式的支持</li>
<li>使用autolayout搭建评论系统，IM系统的界面</li>
<li>自定义CoreTextLabel，支持自定义表情，连接，标签，电话号码，地址等的匹配和相关回调，支持Aautolayout</li>
<li>自定义表情键盘（基于自定义UICollectionView的布局），与系统键盘无缝切换</li>
<li>使用ReactiveCocoa实现MVVM模式，去掉大量状态依赖，减少潜在bug，实现业务逻辑与UI的完美解耦</li>
<li>使用Core Data，存储用户数据</li>
<li>大量优化CollectionView和TableView的滚动速度</li>
<li>大量自定义控件，熟练使用Quartz2D，Core Animation</li>
<li>熟练使用git进行版本管理</li>
<li>实现注册登录流程及Facebook的接入</li>
<li>70%以上的接口对接，使用JSONModel序列化数据</li>
</ul>
<h2 id="智信创想">智信创想</h2><h3 id="iOS_宝来药通_2012-10_-_2013-04">iOS 宝来药通 2012.10 - 2013.04</h3><ul>
<li>封装TableviewController基类，将上下拉，数据存储等功能进行封装</li>
<li>聊天系统，采用Core Text图文混排，支持自定义表情，自定义表情键盘</li>
<li>使用Core Data存储用户数据，熟练使用Magical Record和RestKit</li>
<li>使用RestKit和AFNetworking对接服务端</li>
</ul>
<h1 id="个人优势">个人优势</h1><ul>
<li>很强的学习能力，对新技术能很快的掌握并应用</li>
<li>重视基础，常读Apple官方文档和观看WWDC视频，能快速定位Bug的根本原因</li>
<li>经常阅读优质博客，比如objcio，nshipster等。经常浏览Github上优质的开源项目</li>
<li>支持正版软件</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://devliu.com/2015/08/31/resume/" data-id="cify21btp000vymujfmoezu33" class="article-share-link">Share</a>
      
        <a href="http://devliu.com/2015/08/31/resume/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/resume/">resume</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-iOS常见面试题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/07/26/iOS常见面试题/" class="article-date">
  <time datetime="2015-07-26T15:53:13.000Z" itemprop="datePublished">2015-07-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/26/iOS常见面试题/">iOS常见面试题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在这里记录一下网上流行的iOS面试题，以后面试用。首先就是唐巧最近在微信里发布了一套面试题，在这里记录一下，以后找时间总结一下回答，当然是在弄懂的前提下。仅仅吧答案背下来，却不弄懂是没什么用的。</p>
        
          <p class="article-more-link">
            <a href="/2015/07/26/iOS常见面试题/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://devliu.com/2015/07/26/iOS常见面试题/" data-id="cify21bu8001jymujw0h2br9z" class="article-share-link">Share</a>
      
        <a href="http://devliu.com/2015/07/26/iOS常见面试题/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-git-技巧" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/07/26/git-技巧/" class="article-date">
  <time datetime="2015-07-26T14:53:15.000Z" itemprop="datePublished">2015-07-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/26/git-技巧/">git 技巧</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这是我过去使用git总结的一些技巧和在google和ss上搜到的一些知识，希望大家喜欢。<br>
        
          <p class="article-more-link">
            <a href="/2015/07/26/git-技巧/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://devliu.com/2015/07/26/git-技巧/" data-id="cify21bua001lymujrkv5td66" class="article-share-link">Share</a>
      
        <a href="http://devliu.com/2015/07/26/git-技巧/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/">git</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-V" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/07/26/V/" class="article-date">
  <time datetime="2015-07-26T14:40:58.000Z" itemprop="datePublished">2015-07-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/26/V/">V</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>《V字仇杀队》是我最喜欢的电影之一，当然我不能说没有之一这种屁话，那太绝对了。我不知道如何评论这部电影，或者说我不敢在互联网这个开放的环境下写出我内心真实的感受。或者，我怀疑自己的措辞能力无法表现出这部电影的伟大。But，你需要去看这部电影。</p>
<p>V怪客在电视台向全国民众发表演说的台词：（请原谅我粘贴自网络）<br>
        
          <p class="article-more-link">
            <a href="/2015/07/26/V/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://devliu.com/2015/07/26/V/" data-id="cify21buj001xymujar0k35wd" class="article-share-link">Share</a>
      
        <a href="http://devliu.com/2015/07/26/V/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/电影/">电影</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-uicollectionview-用法小结" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/05/20/uicollectionview-用法小结/" class="article-date">
  <time datetime="2015-05-20T14:37:53.000Z" itemprop="datePublished">2015-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/20/uicollectionview-用法小结/">uicollectionview 用法小结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近项目中要用UICollectionView实现瀑布流，其中遇到了几个问题，在此做一下总结。</p>
<h2 id="项目需求：">项目需求：</h2><p>1.瀑布流需求。如果采用自带的flowlayout，同一行的cell虽然大小不一致，但会居中对齐，不符合需求。<br>2.cell中圆角和阴影共存。</p>
<p>请看效果图<br><img src="/images/uicollectionview/uicollectionview.gif" alt="瀑布流效果图"></p>
        
          <p class="article-more-link">
            <a href="/2015/05/20/uicollectionview-用法小结/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://devliu.com/2015/05/20/uicollectionview-用法小结/" data-id="cify21btl000rymuj01yjg3yz" class="article-share-link">Share</a>
      
        <a href="http://devliu.com/2015/05/20/uicollectionview-用法小结/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ios在获取用户的位置授权之后，做一些事情" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/04/26/ios在获取用户的位置授权之后，做一些事情/" class="article-date">
  <time datetime="2015-04-25T16:07:37.000Z" itemprop="datePublished">2015-04-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/04/26/ios在获取用户的位置授权之后，做一些事情/">iOS在获取用户的位置授权之后，做一些事情</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在做天气模块时，需要获取用户的位置授权，在获取完权限后，我们需要解码城市，然后去服务器请求天气信息<br>1.获取授权后请求天气<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)locationManager:(CLLocationManager *)manager didChangeAuthorizationStatus:(CLAuthorizationStatus)status</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (status == kCLAuthorizationStatusAuthorizedAlways || status == kCLAuthorizationStatusAuthorizedWhenInUse) &#123;</span><br><span class="line">        [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:kLocationManagerAuthorizationStatusChangeNotification object:<span class="literal">nil</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.解码城市<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)locationManager:(CLLocationManager *)manager didUpdateToLocation:(CLLocation *)newLocation fromLocation:(CLLocation *)oldLocation &#123;</span><br><span class="line">    <span class="keyword">self</span><span class="variable">.location2D</span> = newLocation<span class="variable">.coordinate</span>;</span><br><span class="line">    [PersistenceHelper setData:@(<span class="keyword">self</span><span class="variable">.location2D</span><span class="variable">.latitude</span>) forKey:LAT];</span><br><span class="line">    [PersistenceHelper setData:@(<span class="keyword">self</span><span class="variable">.location2D</span><span class="variable">.longitude</span>) forKey:LONG];</span><br><span class="line">    CLGeocoder * geoCoder = [[CLGeocoder alloc] init];</span><br><span class="line">    [geoCoder reverseGeocodeLocation:newLocation completionHandler:^(<span class="built_in">NSArray</span> *placemarks, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">        <span class="keyword">for</span> (CLPlacemark * placemark <span class="keyword">in</span> placemarks) &#123;</span><br><span class="line">            <span class="built_in">NSString</span> *city = placemark<span class="variable">.administrativeArea</span>;</span><br><span class="line">            <span class="keyword">if</span> ([city hasSuffix:<span class="string">@"市"</span>]) &#123;</span><br><span class="line">                city = [city substringToIndex:city<span class="variable">.length</span>-<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (city<span class="variable">.length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">self</span><span class="variable">.cityName</span> = city;</span><br><span class="line">                [PersistenceHelper setData:city forKey:<span class="built_in">CITY</span>];</span><br><span class="line">                [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:kLocationManagerAuthorizationStatusChangeNotification object:<span class="literal">nil</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [manager stopUpdatingLocation];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://devliu.com/2015/04/26/ios在获取用户的位置授权之后，做一些事情/" data-id="cify21btt0012ymuj3qfld4fm" class="article-share-link">Share</a>
      
        <a href="http://devliu.com/2015/04/26/ios在获取用户的位置授权之后，做一些事情/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-reactivecocoa用法小记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/04/25/reactivecocoa用法小记/" class="article-date">
  <time datetime="2015-04-25T15:51:46.000Z" itemprop="datePublished">2015-04-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/04/25/reactivecocoa用法小记/">reactivecocoa用法小记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1.绑定UI元素和数据<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RAC(<span class="keyword">self</span>, city<span class="variable">.text</span>) = RACObserve(<span class="keyword">self</span>, weatherModel<span class="variable">.city_name</span>);</span><br></pre></td></tr></table></figure></p>
<p>2.观察数据，数据变化时做下一步操作<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[RACObserve(<span class="keyword">self</span>, weizhangData<span class="variable">.zongmoney</span>) subscribeNext:^(<span class="built_in">NSNumber</span> *zongmoney) &#123;</span><br><span class="line">    <span class="keyword">if</span> (zongmoney) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *string = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@%@元"</span>, <span class="string">@"罚款："</span>, zongmoney];</span><br><span class="line">        <span class="built_in">NSMutableAttributedString</span> *attrString = [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:string];</span><br><span class="line">        <span class="built_in">UIColor</span> *color = [<span class="built_in">UIColor</span> redColor]; <span class="comment">// select needed color</span></span><br><span class="line">        <span class="built_in">NSDictionary</span> *attrs = @&#123;<span class="built_in">NSForegroundColorAttributeName</span>: color&#125;;</span><br><span class="line">        [attrString addAttributes:attrs range:[string rangeOfString:[zongmoney stringValue]]];</span><br><span class="line">        <span class="keyword">self</span><span class="variable">.penalty</span><span class="variable">.attributedText</span> = attrString;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure></p>
<p>3.uibutton 设置事件<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="keyword">self</span><span class="variable">.askBtn</span> rac_signalForControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>] subscribeNext:^(<span class="keyword">id</span> x) &#123;</span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span><span class="variable">.delegate</span> respondsToSelector:<span class="keyword">@selector</span>(addCarTextCellAskPress:)]) &#123;</span><br><span class="line">        [<span class="keyword">self</span><span class="variable">.delegate</span> addCarTextCellAskPress:<span class="keyword">self</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure></p>
<p>4.检测nsuserdefault<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[[[<span class="built_in">NSUserDefaults</span> standardUserDefaults] rac_valuesForKeyPath:<span class="built_in">UID</span> observer:<span class="keyword">self</span>] subscribeNext:^(<span class="built_in">NSNumber</span> *uid) &#123;</span><br><span class="line">    <span class="keyword">self</span><span class="variable">.uid</span> = uid;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://devliu.com/2015/04/25/reactivecocoa用法小记/" data-id="cify21btr000yymuju6ffldrh" class="article-share-link">Share</a>
      
        <a href="http://devliu.com/2015/04/25/reactivecocoa用法小记/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-autolayout下更新布局文件时采用动画" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/04/25/autolayout下更新布局文件时采用动画/" class="article-date">
  <time datetime="2015-04-25T15:44:59.000Z" itemprop="datePublished">2015-04-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/04/25/autolayout下更新布局文件时采用动画/">autolayout下更新布局文件时采用动画</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1.在IB中找到对应的constraints<br>2.改变这个constraints<br>3.对相应的元素调用 setNeedsUpdateConstraints<br>4.在动画中对该元素调用 layoutIfNeeded</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)bindAd</span><br><span class="line">&#123;</span><br><span class="line">    [RACObserve(<span class="keyword">self</span>, adModel) subscribeNext:^(AdModel *ad) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ad) &#123;</span><br><span class="line">            <span class="keyword">self</span><span class="variable">.adBanner</span><span class="variable">.hidden</span> = <span class="literal">NO</span>;</span><br><span class="line">            <span class="keyword">self</span><span class="variable">.adBanner</span><span class="variable">.adModel</span> = ad;</span><br><span class="line">            <span class="keyword">self</span><span class="variable">.weatherIconTopSpace</span><span class="variable">.constant</span> = <span class="number">12</span> + <span class="built_in">CGRectGetHeight</span>(<span class="keyword">self</span><span class="variable">.adBanner</span><span class="variable">.frame</span>);</span><br><span class="line">            [<span class="keyword">self</span><span class="variable">.weatherIcon</span> setNeedsUpdateConstraints];</span><br><span class="line">            [<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.3</span> animations:^&#123;</span><br><span class="line">                [<span class="keyword">self</span><span class="variable">.weatherIcon</span> layoutIfNeeded];</span><br><span class="line">            &#125;];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">self</span><span class="variable">.adBanner</span><span class="variable">.hidden</span> = <span class="literal">YES</span>;</span><br><span class="line">            <span class="built_in">CGFloat</span> topSpace = <span class="number">12</span>;</span><br><span class="line">            <span class="keyword">self</span><span class="variable">.weatherIconTopSpace</span><span class="variable">.constant</span> = topSpace;</span><br><span class="line">            [<span class="keyword">self</span><span class="variable">.weatherIcon</span> setNeedsUpdateConstraints];</span><br><span class="line">            [<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.3</span> animations:^&#123;</span><br><span class="line">                [<span class="keyword">self</span><span class="variable">.weatherIcon</span> layoutIfNeeded];</span><br><span class="line">            &#125;];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意，你再改变某个constraint的时候，相关的constraints是会联动的</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://devliu.com/2015/04/25/autolayout下更新布局文件时采用动画/" data-id="cify21buh001vymujk1deu3j1" class="article-share-link">Share</a>
      
        <a href="http://devliu.com/2015/04/25/autolayout下更新布局文件时采用动画/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/English/">English</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Objective-C/">Objective-C</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xcode/">Xcode</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gcd/">gcd</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/">iOS</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/life/">life</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/resume/">resume</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/杂/">杂</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/电影/">电影</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/群辉/">群辉</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/English/" style="font-size: 16.67px;">English</a> <a href="/tags/Objective-C/" style="font-size: 10px;">Objective-C</a> <a href="/tags/Xcode/" style="font-size: 13.33px;">Xcode</a> <a href="/tags/gcd/" style="font-size: 10px;">gcd</a> <a href="/tags/git/" style="font-size: 13.33px;">git</a> <a href="/tags/iOS/" style="font-size: 20px;">iOS</a> <a href="/tags/life/" style="font-size: 10px;">life</a> <a href="/tags/resume/" style="font-size: 10px;">resume</a> <a href="/tags/杂/" style="font-size: 10px;">杂</a> <a href="/tags/电影/" style="font-size: 10px;">电影</a> <a href="/tags/算法/" style="font-size: 10px;">算法</a> <a href="/tags/群辉/" style="font-size: 10px;">群辉</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">January 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">November 2013</a><span class="archive-list-count">6</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/10/19/Objective-C-内存管理学习笔记/">Objective-C 内存管理学习笔记</a>
          </li>
        
          <li>
            <a href="/2015/10/05/ReactiveCocoa/">ReactiveCocoa</a>
          </li>
        
          <li>
            <a href="/2015/08/31/resume/">resume</a>
          </li>
        
          <li>
            <a href="/2015/07/26/iOS常见面试题/">iOS常见面试题</a>
          </li>
        
          <li>
            <a href="/2015/07/26/git-技巧/">git 技巧</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'devliu';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>